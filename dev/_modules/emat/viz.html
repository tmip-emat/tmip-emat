

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>emat.viz &mdash; TMIP-EMAT 0.6.4, January 2025 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/tmip_emat.css?v=eec227e2" />
      <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/thebelab.css" />

  
      <script src="../../_static/documentation_options.js?v=ff12c608"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/thebelab-helper.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            TMIP-EMAT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/emat.intro.html">Introduction to EMAT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/emat.install.html">Installation and Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/emat.scope/index.html">Exploratory Scoping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/emat.design/emat.design.html">Experimental Designs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/emat.models/index.html">Core Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/emat.metamodels/index.html">Meta Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/emat.database/index.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/emat.analysis/index.html">Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/emat.examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/emat.glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/emat.method-index.html">Methodology Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/emat.references.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TMIP-EMAT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">emat.viz</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for emat.viz</h1><div class="highlight"><pre>
<span></span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..database.database</span><span class="w"> </span><span class="kn">import</span> <span class="n">Database</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.scatter</span><span class="w"> </span><span class="kn">import</span> <span class="n">scatter_graph_row</span><span class="p">,</span> <span class="n">ScatterMass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..util</span><span class="w"> </span><span class="kn">import</span> <span class="n">xmle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">plotly.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">DEFAULT_PLOTLY_COLORS</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>

<span class="n">COLOR_BLUE</span> <span class="o">=</span> <span class="s2">&quot;rgb(31, 119, 180)&quot;</span>
<span class="n">COLOR_RED</span> <span class="o">=</span> <span class="s1">&#39;rgb(227, 20, 20)&#39;</span>
<span class="n">COLOR_GREEN</span> <span class="o">=</span> <span class="s2">&quot;rgb(44, 160, 44)&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_pick_color</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
	<span class="n">lev</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_lever_names</span><span class="p">()</span>
	<span class="n">unc</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_uncertainty_names</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">lev</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lev</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">COLOR_BLUE</span>
		<span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">unc</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">COLOR_RED</span>
		<span class="k">return</span> <span class="n">COLOR_BLUE</span>
	<span class="k">elif</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">unc</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lev</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">COLOR_BLUE</span>
		<span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">unc</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">COLOR_RED</span>
		<span class="k">return</span> <span class="n">COLOR_RED</span>
	<span class="k">else</span><span class="p">:</span> <span class="c1"># y in meas</span>
		<span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lev</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">COLOR_BLUE</span>
		<span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">unc</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">COLOR_RED</span>
		<span class="k">return</span> <span class="n">COLOR_GREEN</span>


<div class="viewcode-block" id="scatter_graphs">
<a class="viewcode-back" href="../../source/emat.analysis/splom.html#emat.viz.scatter_graphs">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">scatter_graphs</span><span class="p">(</span>
		<span class="n">column</span><span class="p">,</span>
		<span class="n">data</span><span class="p">,</span>
		<span class="n">scope</span><span class="p">,</span>
		<span class="n">db</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
		<span class="n">contrast</span><span class="o">=</span><span class="s1">&#39;infer&#39;</span><span class="p">,</span>
		<span class="n">marker_opacity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
		<span class="n">mass</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
		<span class="n">render</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
		<span class="n">use_gl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Generate a row of scatter plots comparing one column against others.</span>

<span class="sd">	Args:</span>
<span class="sd">		column (str):</span>
<span class="sd">			The name of the principal parameter or measure to analyze.</span>
<span class="sd">		data (pandas.DataFrame or str): The experimental results to plot.</span>
<span class="sd">			Can be given as a DataFrame or as the name of a design (in</span>
<span class="sd">			which case the results are loaded from the provided `db`).</span>
<span class="sd">		scope (Scope, optional): The exploratory scope.</span>
<span class="sd">		db (Database, optional):</span>
<span class="sd">			The database containing the results. This is ignored unless</span>
<span class="sd">			`data` is a string.</span>
<span class="sd">		contrast (str or list):</span>
<span class="sd">			The contrast columns to plot the principal parameter or</span>
<span class="sd">			measure against.  Can be given as a list of columns that</span>
<span class="sd">			appear in the data, or one of {&#39;uncertainties&#39;, &#39;levers&#39;,</span>
<span class="sd">			&#39;parameters&#39;, &#39;measures&#39;, &#39;infer&#39;}. If set to &#39;infer&#39;, the</span>
<span class="sd">			contrast will be &#39;measures&#39; if `column` is a parameter,</span>
<span class="sd">			and &#39;parameters&#39; if `columns` is a measure.</span>
<span class="sd">		marker_opacity (float, optional):</span>
<span class="sd">			The opacity to use for markers. If the number of markers is</span>
<span class="sd">			large, the figure may appear as a solid blob; by setting opacity</span>
<span class="sd">			to less than 1.0, the figure can more readily show relative</span>
<span class="sd">			density in various regions.  If not specified, marker_opacity</span>
<span class="sd">			is set based on `mass` instead.</span>
<span class="sd">		mass (int or emat.viz.ScatterMass, default 1000):</span>
<span class="sd">			The target number of rendered points in each figure. Setting</span>
<span class="sd">			to a number less than the number of experiments will make</span>
<span class="sd">			each scatter point partially transparent, which will help</span>
<span class="sd">			visually convey relative density when there are a very large</span>
<span class="sd">			number of points.</span>
<span class="sd">		render (str or dict, optional):</span>
<span class="sd">			If given, the graph[s] will be rendered to a static image</span>
<span class="sd">			using `plotly.io.to_image`.  For default settings, pass</span>
<span class="sd">			&#39;png&#39;, or give a dictionary that specifies keyword arguments</span>
<span class="sd">			to that function.  See `emat.util.rendering.render_plotly`</span>
<span class="sd">			for more details.</span>
<span class="sd">		use_gl (bool, default True):</span>
<span class="sd">			Use Plotly&#39;s `Scattergl` instead of `Scatter`, which may</span>
<span class="sd">			provide some performance benefit for large data sets.</span>

<span class="sd">	Returns:</span>
<span class="sd">		FigureWidget or xmle.Elem</span>

<span class="sd">	Raises:</span>
<span class="sd">		ValueError: If `contrast` is &#39;infer&#39; but `column` is neither a parameter</span>
<span class="sd">			nor a measure.</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">if</span> <span class="n">contrast</span> <span class="o">==</span> <span class="s1">&#39;infer&#39;</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_uncertainty_names</span><span class="p">():</span>
			<span class="n">contrast</span> <span class="o">=</span> <span class="s1">&#39;measures&#39;</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_lever_names</span><span class="p">():</span>
			<span class="n">contrast</span> <span class="o">=</span> <span class="s1">&#39;measures&#39;</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_measure_names</span><span class="p">():</span>
			<span class="n">contrast</span> <span class="o">=</span> <span class="s1">&#39;parameters&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;cannot infer what to contrast against&#39;</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">contrast</span> <span class="o">==</span> <span class="s1">&#39;uncertainties&#39;</span><span class="p">:</span>
		<span class="n">contrast</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_uncertainty_names</span><span class="p">()</span>
	<span class="k">elif</span> <span class="n">contrast</span> <span class="o">==</span> <span class="s1">&#39;levers&#39;</span><span class="p">:</span>
		<span class="n">contrast</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_lever_names</span><span class="p">()</span>
	<span class="k">elif</span> <span class="n">contrast</span> <span class="o">==</span> <span class="s1">&#39;parameters&#39;</span><span class="p">:</span>
		<span class="n">contrast</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_uncertainty_names</span><span class="p">()</span> <span class="o">+</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_lever_names</span><span class="p">()</span>
	<span class="k">elif</span> <span class="n">contrast</span> <span class="o">==</span> <span class="s1">&#39;measures&#39;</span><span class="p">:</span>
		<span class="n">contrast</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_measure_names</span><span class="p">()</span>

	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;db cannot be None if data is a design name&#39;</span><span class="p">)</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read_experiment_all</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
		<span class="n">mass</span> <span class="o">=</span> <span class="n">ScatterMass</span><span class="p">(</span><span class="n">mass</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">marker_opacity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">marker_opacity</span> <span class="o">=</span> <span class="n">mass</span><span class="o">.</span><span class="n">get_opacity</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

	<span class="n">y_title</span> <span class="o">=</span> <span class="n">column</span>
	<span class="k">if</span> <span class="n">scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">y_title</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">shortname</span><span class="p">(</span><span class="n">y_title</span><span class="p">)</span>

	<span class="n">contrast_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contrast</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
	<span class="n">contrast_color</span> <span class="o">=</span> <span class="p">[</span><span class="n">_pick_color</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contrast_cols</span><span class="p">]</span>

	<span class="n">fig</span> <span class="o">=</span> <span class="n">scatter_graph_row</span><span class="p">(</span>
		<span class="n">contrast_cols</span><span class="p">,</span>
		<span class="n">column</span><span class="p">,</span>
		<span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
		<span class="n">marker_opacity</span><span class="o">=</span><span class="n">marker_opacity</span><span class="p">,</span>
		<span class="n">y_title</span><span class="o">=</span><span class="n">y_title</span><span class="p">,</span>
		<span class="n">layout</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
			<span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
		<span class="p">),</span>
		<span class="n">short_name_func</span><span class="o">=</span><span class="n">scope</span><span class="o">.</span><span class="n">shortname</span> <span class="k">if</span> <span class="n">scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
		<span class="n">use_gl</span><span class="o">=</span><span class="n">use_gl</span><span class="p">,</span>
		<span class="n">C</span><span class="o">=</span><span class="n">contrast_color</span><span class="p">,</span>
	<span class="p">)</span>

	<span class="k">if</span> <span class="n">render</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">render</span> <span class="o">==</span> <span class="s1">&#39;png&#39;</span><span class="p">:</span>
			<span class="n">render</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">contrast_cols</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">render</span> <span class="o">==</span> <span class="s1">&#39;svg&#39;</span><span class="p">:</span>
			<span class="n">render</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">contrast_cols</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="mi">270</span><span class="p">)</span>

		<span class="kn">from</span><span class="w"> </span><span class="nn">..util.rendering</span><span class="w"> </span><span class="kn">import</span> <span class="n">render_plotly</span>
		<span class="k">return</span> <span class="n">render_plotly</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">render</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">fig</span></div>



<div class="viewcode-block" id="scatter_graphs_2">
<a class="viewcode-back" href="../../source/emat.analysis/splom.html#emat.viz.scatter_graphs_2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">scatter_graphs_2</span><span class="p">(</span>
		<span class="n">column</span><span class="p">,</span>
		<span class="n">datas</span><span class="p">,</span>
		<span class="n">scope</span><span class="p">,</span>
		<span class="n">db</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
		<span class="n">contrast</span><span class="o">=</span><span class="s1">&#39;infer&#39;</span><span class="p">,</span>
		<span class="n">render</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
		<span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
		<span class="n">use_gl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
		<span class="n">mass</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Generate a row of scatter plots comparing multiple datasets.</span>

<span class="sd">	This function is similar to `scatter_graphs`, but accepts</span>
<span class="sd">	multiple data sets and plots them using different colors.</span>

<span class="sd">	Args:</span>
<span class="sd">		column (str):</span>
<span class="sd">			The name of the principal parameter or measure to analyze.</span>
<span class="sd">		datas (Collection[pandas.DataFrame or str]):</span>
<span class="sd">			The experimental results to plot. Can be given as a DataFrame</span>
<span class="sd">			or as the name of a design (in which case the results are</span>
<span class="sd">			loaded from the provided Database `db`).</span>
<span class="sd">		scope (Scope, optional): The exploratory scope.</span>
<span class="sd">		db (Database, optional):</span>
<span class="sd">			The database containing the results.  Ignored unless `data`</span>
<span class="sd">			is a string.</span>
<span class="sd">		contrast (str or list):</span>
<span class="sd">			The contrast columns to plot the principal parameter or</span>
<span class="sd">			measure against.  Can be given as a list of columns that</span>
<span class="sd">			appear in the data, or one of {&#39;uncertainties&#39;, &#39;levers&#39;,</span>
<span class="sd">			&#39;parameters&#39;, &#39;measures&#39;, &#39;infer&#39;}. If set to &#39;infer&#39;,</span>
<span class="sd">			the contrast will be &#39;measures&#39; if `column` is a parameter,</span>
<span class="sd">			and &#39;parameters&#39; if `columns` is a measure.</span>
<span class="sd">		render (str or dict, optional):</span>
<span class="sd">			If given, the graph[s] will be rendered to a static image</span>
<span class="sd">			using `plotly.io.to_image`.  For default settings, pass</span>
<span class="sd">			&#39;png&#39;, or give a dictionary that specifies keyword arguments</span>
<span class="sd">			to that function.  See `emat.util.rendering.render_plotly`</span>
<span class="sd">			for more details.</span>
<span class="sd">		mass (int or emat.viz.ScatterMass, default 1000):</span>
<span class="sd">			The target number of rendered points in each figure. Setting</span>
<span class="sd">			to a number less than the number of experiments will make</span>
<span class="sd">			each scatter point partially transparent, which will help</span>
<span class="sd">			visually convey relative density when there are a very large</span>
<span class="sd">			number of points.</span>

<span class="sd">	Returns:</span>
<span class="sd">		plotly.FigureWidget or xmle.Elem:</span>
<span class="sd">			The latter is returned if a `render` argument is used.</span>

<span class="sd">	Raises:</span>
<span class="sd">		ValueError:</span>
<span class="sd">			If `contrast` is &#39;infer&#39; but `column` is neither a parameter</span>
<span class="sd">			nor a measure.</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">if</span> <span class="n">contrast</span> <span class="o">==</span> <span class="s1">&#39;infer&#39;</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_uncertainty_names</span><span class="p">():</span>
			<span class="n">contrast</span> <span class="o">=</span> <span class="s1">&#39;measures&#39;</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_lever_names</span><span class="p">():</span>
			<span class="n">contrast</span> <span class="o">=</span> <span class="s1">&#39;measures&#39;</span>
		<span class="k">elif</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_measure_names</span><span class="p">():</span>
			<span class="n">contrast</span> <span class="o">=</span> <span class="s1">&#39;parameters&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;cannot infer what to contrast against&#39;</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">contrast</span> <span class="o">==</span> <span class="s1">&#39;uncertainties&#39;</span><span class="p">:</span>
		<span class="n">contrast</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_uncertainty_names</span><span class="p">()</span>
	<span class="k">elif</span> <span class="n">contrast</span> <span class="o">==</span> <span class="s1">&#39;levers&#39;</span><span class="p">:</span>
		<span class="n">contrast</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_lever_names</span><span class="p">()</span>
	<span class="k">elif</span> <span class="n">contrast</span> <span class="o">==</span> <span class="s1">&#39;parameters&#39;</span><span class="p">:</span>
		<span class="n">contrast</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_uncertainty_names</span><span class="p">()</span> <span class="o">+</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_lever_names</span><span class="p">()</span>
	<span class="k">elif</span> <span class="n">contrast</span> <span class="o">==</span> <span class="s1">&#39;measures&#39;</span><span class="p">:</span>
		<span class="n">contrast</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_measure_names</span><span class="p">()</span>

	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
		<span class="n">mass</span> <span class="o">=</span> <span class="n">ScatterMass</span><span class="p">(</span><span class="n">mass</span><span class="p">)</span>

	<span class="n">data_</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">marker_opacity_</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">fig</span> <span class="o">=</span> <span class="s1">&#39;widget&#39;</span>
	<span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">colorcycle</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="n">DEFAULT_PLOTLY_COLORS</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">colorcycle</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">datas</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">db</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;db cannot be None if data is a design name&#39;</span><span class="p">)</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read_experiment_all</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="n">data_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_</span><span class="p">:</span>
		<span class="n">marker_opacity_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mass</span><span class="o">.</span><span class="n">get_opacity</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

		<span class="n">y_title</span> <span class="o">=</span> <span class="n">column</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">y_title</span> <span class="o">=</span> <span class="n">scope</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">shortname</span>
		<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
			<span class="k">pass</span>

		<span class="n">fig</span> <span class="o">=</span> <span class="n">scatter_graph_row</span><span class="p">(</span>
			<span class="p">[(</span><span class="n">c</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contrast</span><span class="p">],</span>
			<span class="n">column</span><span class="p">,</span>
			<span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
			<span class="n">marker_opacity</span><span class="o">=</span><span class="n">marker_opacity_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
			<span class="n">y_title</span><span class="o">=</span><span class="n">y_title</span><span class="p">,</span>
			<span class="n">layout</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
				<span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
			<span class="p">),</span>
			<span class="n">output</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
			<span class="n">C</span><span class="o">=</span><span class="n">colorcycle</span><span class="o">.</span><span class="fm">__next__</span><span class="p">(),</span>
			<span class="n">short_name_func</span><span class="o">=</span><span class="n">scope</span><span class="o">.</span><span class="n">shortname</span> <span class="k">if</span> <span class="n">scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
			<span class="n">use_gl</span><span class="o">=</span><span class="n">use_gl</span><span class="p">,</span>
		<span class="p">)</span>

	<span class="k">if</span> <span class="n">render</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">render</span> <span class="o">==</span> <span class="s1">&#39;png&#39;</span><span class="p">:</span>
			<span class="n">render</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">render</span> <span class="o">==</span> <span class="s1">&#39;svg&#39;</span><span class="p">:</span>
			<span class="n">render</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">270</span><span class="p">)</span>

		<span class="kn">from</span><span class="w"> </span><span class="nn">..util.rendering</span><span class="w"> </span><span class="kn">import</span> <span class="n">render_plotly</span>
		<span class="k">return</span> <span class="n">render_plotly</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">render</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">fig</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">heatmap_table</span><span class="p">(</span>
		<span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.3f&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
		<span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
		<span class="n">attach_metadata</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
		<span class="n">scale_color_by_row</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
		<span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Generate a SVG heatmap from data.</span>

<span class="sd">	Args:</span>
<span class="sd">		data (pandas.DataFrame): source data for the heatmap table.</span>
<span class="sd">		cmap (str): A colormap for the resulting heatmap.</span>
<span class="sd">		fmt (str): how to format values</span>
<span class="sd">		linewidths (float): Line widths for the table.</span>
<span class="sd">		figsize (tuple): The size of the resulting figure.</span>
<span class="sd">		xlabel, ylabel, title (str, optional): Captions for each.</span>
<span class="sd">		attach_metadata (bool, default True): Attach `data` to the</span>
<span class="sd">			resulting figure as metadata.</span>
<span class="sd">		scale_color_by_row (bool, default True):</span>
<span class="sd">			Color rows independently.</span>

<span class="sd">	Returns:</span>
<span class="sd">		xmle.Elem: The xml data for a svg rendering.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
	<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
	<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">scale_color_by_row</span><span class="p">:</span>
		<span class="n">coloring</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">coloring</span> <span class="o">=</span> <span class="n">data</span>
	<span class="n">axes</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
		<span class="n">coloring</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
		<span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span>
		<span class="n">cbar</span><span class="o">=</span><span class="ow">not</span> <span class="n">scale_color_by_row</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
	<span class="p">)</span>
	<span class="k">if</span> <span class="n">xlabel</span><span class="p">:</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
	<span class="n">result</span><span class="o">=</span> <span class="n">xmle</span><span class="o">.</span><span class="n">Elem</span><span class="o">.</span><span class="n">from_figure</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">get_figure</span><span class="p">())</span>
	<span class="k">if</span> <span class="n">attach_metadata</span><span class="p">:</span>
		<span class="n">result</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">data</span>
	<span class="k">return</span> <span class="n">result</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>